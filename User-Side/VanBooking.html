<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Van Booking - Modern Reservation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700;800&display=swap');

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .gradient-booking {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        }

        .form-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .input-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }

        .input-with-icon {
            padding-left: 40px;
        }

        #map {
            height: 300px;
            width: 100%;
            border-radius: 15px;
            margin-top: 20px;
        }

        .animate-float {
            animation: float 4s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }

    </style>
</head>
<body class="antialiased min-h-screen flex items-center justify-center p-6">
<div class="max-w-6xl w-full bg-white rounded-3xl overflow-hidden shadow-2xl flex animate-float">
    <!-- Left Inspirational Section -->
    <div class="w-1/2 gradient-booking text-white p-12 flex items-center relative overflow-hidden">
        <div class="z-10 relative">
            <h2 class="text-5xl font-extrabold mb-6 tracking-tight">Book Your Journey</h2>
            <p class="text-xl mb-8 opacity-80">Discover comfort, convenience, and reliability</p>

            <div class="bg-white bg-opacity-20 backdrop-blur-md p-8 rounded-2xl">
                <h3 class="text-2xl font-semibold mb-4">Need Assistance?</h3>
                <p class="mb-4 text-sm opacity-75">Our dedicated support team is ready to help</p>
                <button class="w-full bg-white text-indigo-600 py-3 rounded-lg font-semibold hover:bg-gray-100 transition transform hover:scale-105">
                    Contact Support
                </button>
            </div>
        </div>
    </div>

    <!-- Booking Form -->
    <div class="w-1/2 p-12 bg-white">
        <form id="bookingFormVan" class="space-y-6">
            <div class="grid grid-cols-2 gap-6">
                <div class="relative">
                    <label class="block text-sm font-medium text-gray-700 mb-2">User ID</label>
                    <input
                            type="text"
                            id="userId"
                            name="userId"
                            required
                            class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none input-with-icon"
                            placeholder="Enter User ID"
                            readonly
                    >
                    <svg class="input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>

                <div class="relative">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Van Id</label>
                    <input
                            type="text"
                            id="vanId"
                            name="vanId"
                            required
                            class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none input-with-icon"
                            placeholder="Select Van"
                            readonly
                    >
                    <svg class="input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                    </svg>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                    <input
                            type="text"
                            id="fullName"
                            name="fullName"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            placeholder="Enter your name"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input
                            type="email"
                            id="email"
                            name="email"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            placeholder="you@example.com"
                    >
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
                    <input
                            type="text"
                            id="mobile"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            placeholder="Enter your Mobile Number"
                    >
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Van Model</label>
                    <input
                            type="text"
                            id="vanModel"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            placeholder=""
                            readonly
                    >
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pickup Location</label>
                    <input type="text" id="pickupLocation" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Select pickup location">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Drop-off Location</label>
                    <input type="text" id="dropLocation" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Select drop location">
                </div>
            </div>
            <div id="map"></div> <!-- Map Display -->

            <div class="grid grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pickup Date</label>
                    <input
                            type="date"
                            id="pickupDate"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                    >
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Return Date</label>
                    <input
                            type="date"
                            id="returnDate"
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                    >
                </div>
                <div>
                    <label for="pickupTime" class="block text-sm font-medium text-gray-700 mb-2">
                        Pickup Time
                    </label>
                    <input
                            type="time"
                            id="pickupTime"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            required
                    />
                </div>
                <div>
                    <label for="pickupTime" class="block text-sm font-medium text-gray-700 mb-2">
                        Return Time
                    </label>
                    <input
                            type="time"
                            id="returnTime"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            required
                    />
                </div>
                <div class="relative">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount Paid</label>
                    <input
                            type="text"
                            id="price"
                            name="price"
                            required
                            class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none input-with-icon"
                            readonly
                    >
                    <svg class="input-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                    </svg>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Additional Information</label>
                <textarea
                        id="additionalInfo"
                        rows="3"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                        placeholder="Any special requirements?"
                ></textarea>
            </div>

            <button
                    type="submit"
                    class="w-full bg-gradient-to-r from-purple-600 to-blue-500 text-white py-4 rounded-lg hover:from-purple-700 hover:to-blue-600 transition font-semibold text-lg transform hover:scale-105"
            >
                Book Your Bus
            </button>
        </form>
    </div>
</div>

<script>

    let map;
    let pickupLocationLatLng = null;
    let dropLocationLatLng = null;

    function initMap() {
        console.log('Initializing map...');

        const defaultLocation = { lat: 7.8731, lng: 80.7718 };

        map = new google.maps.Map(document.getElementById("map"), {
            center: defaultLocation,
            zoom: 8,
        });

        const pickupInput = document.getElementById("pickupLocation");
        const dropInput = document.getElementById("dropLocation");

        const pickupAutocomplete = new google.maps.places.Autocomplete(pickupInput);
        const dropAutocomplete = new google.maps.places.Autocomplete(dropInput);

        const pickupMarker = new google.maps.Marker({
            map: map,
            icon: {
                url: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
            }
        });

        const dropMarker = new google.maps.Marker({
            map: map,
            icon: {
                url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
            }
        });

        // Pickup Location Listener
        pickupAutocomplete.addListener("place_changed", function () {
            const place = pickupAutocomplete.getPlace();
            if (!place.geometry) {
                alert("No details available for input: '" + place.name + "'");
                return;
            }

            pickupLocationLatLng = place.geometry.location;
            pickupMarker.setPosition(pickupLocationLatLng);
            map.setCenter(pickupLocationLatLng);
            map.setZoom(12);

            const infoWindow = new google.maps.InfoWindow({
                content: `<strong>Pickup Location:</strong> ${place.formatted_address}`
            });
            infoWindow.open(map, pickupMarker);

            // Recalculate price if both locations selected
            if (pickupLocationLatLng && dropLocationLatLng) {
                calculateDistanceAndPrice(pickupLocationLatLng, dropLocationLatLng);
            }
        });

        // Drop Location Listener
        dropAutocomplete.addListener("place_changed", function () {
            const place = dropAutocomplete.getPlace();
            if (!place.geometry) {
                alert("No details available for input: '" + place.name + "'");
                return;
            }

            dropLocationLatLng = place.geometry.location;
            dropMarker.setPosition(dropLocationLatLng);
            map.setCenter(dropLocationLatLng);
            map.setZoom(12);

            const infoWindow = new google.maps.InfoWindow({
                content: `<strong>Drop-off Location:</strong> ${place.formatted_address}`
            });
            infoWindow.open(map, dropMarker);

            // Recalculate price if both locations selected
            if (pickupLocationLatLng && dropLocationLatLng) {
                calculateDistanceAndPrice(pickupLocationLatLng, dropLocationLatLng);
            }
        });

        console.log('Map initialized successfully');
    }

    function calculateDistanceAndPrice(pickupLocation, dropLocation) {
        const service = new google.maps.DistanceMatrixService();

        service.getDistanceMatrix(
            {
                origins: [pickupLocation],
                destinations: [dropLocation],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC
            },
            function (response, status) {
                console.log("response" +response)
                if (status === 'OK') {
                    const distanceValue = response.rows[0].elements[0].distance.value; // in meters
                    const distanceInKm = distanceValue / 1000;
                    const price = Math.round(distanceInKm * 100); // 100 LKR per km
                    document.getElementById("price").value = price + "";
                } else {
                    console.error('Error fetching distance:', status);
                    document.getElementById("price").value = "Distance error";
                }
            }
        );
    }

    // Google Maps API Error Handlers
    window.gm_authFailure = function () {
        console.error('Google Maps authentication failed');
        document.getElementById('map').innerHTML = '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">Failed to load Google Maps. Please check your API key.</div>';
    };

    function handleMapError() {
        console.error('Failed to load Google Maps JavaScript API');
        document.getElementById('map').innerHTML = '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">Could not load Google Maps. Please check your internet connection.</div>';
    }
</script>

<!-- Load Google Maps API with a single script tag -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfeewXCdO_bM4RMfbIxB2W1YrcXLD45rM&libraries=places&callback=initMap" async defer onerror="handleMapError()"></script>

<script src="Js/VanBookingCustomer.js"></script>
<script src="Js/BusBoookingCustomer.js"></script>
<script src="Js/VanPage.js"></script>


</body>
</html>